jQuery(function($){let bookingEntry=$(".detail-booking-entrypoint");let calendarSlider;let calendarSliderIndex=0;let calendarSliderIndexTemp=null;if(bookingEntry.length>0){let bookingEntryTransportType=$('.booking-filter-radio--transport-type input[type="radio"]');let bookingEntryAirportField=$(".booking-filter-item--airport");bookingEntryTransportType.on("change",function(e){var thisType=$(this).val();if(thisType=="FLUG"){bookingEntryAirportField.removeClass("d-none")}else{bookingEntryAirportField.addClass("d-none")}checkOfferIsValid()});let bookingEntryCalendar=$(".booking-filter-field--date-range");let bookingEntryCalendarRenderTarget=$("#booking-entry-calendar");let bookingEntryCalendarServiceUrl="/wp-content/themes/travelshop/pm-ajax-endpoint.php?action=detail-booking-calendar";let bookingOfferValidationServiceUrl="/wp-content/themes/travelshop/pm-ajax-endpoint.php?action=offer-validation";$(document).click(function(event){var $target=$(event.target);if($(".booking-filter-item--date-range").length>0&&$(".booking-filter-item--date-range").hasClass("open")){if(!$target.hasClass("booking-filter-item--date-range")&&$target.parents(".booking-filter-item--date-range").length<1){$(".booking-filter-item--date-range").removeClass("open");calendarSliderIndexTemp=null}}});bookingEntryCalendar.on("click touch",function(e){e.preventDefault();var getTransportType,getAirport,getDur,getOfferID,getMediaObjectID=null;getTransportType=$('.booking-filter-radio--transport-type input[type="radio"]:checked').val();getDur=$(".booking-filter-field--duration").val();getOfferID=$(".booking-filter-field--offer-id").val();getMediaObjectID=$(".booking-filter-field--mediaobject-id").val();if(getTransportType==="FLUG"){getAirport=bookingEntryAirportField.find('input[type="radio"]:checked').val()}renderBookingCalendar(getTransportType,getAirport,getDur,getOfferID,getMediaObjectID);$(".dropdown, .dropdown-menu").removeClass("show");e.stopPropagation()});function checkOfferIsValid(){var getAirport=null;var getTransportType=$('.booking-filter-radio--transport-type input[type="radio"]:checked').val();var getDur=$(".booking-filter-field--duration").val();var getOfferID=$(".booking-filter-field--offer-id").val();var getMediaObjectID=$(".booking-filter-field--mediaobject-id").val();if(getTransportType==="FLUG"){getAirport=bookingEntryAirportField.find('input[type="radio"]:checked').val()}var validateOfferRequest={"pm-tr":getTransportType,airport:getAirport,"pm-du":getDur,offer_id:getOfferID,media_object_id:getMediaObjectID};requestHandlerOfferValidation(validateOfferRequest)}function initCalendarSlider(){var sliderWrapper=".booking-entrypoint-calendar-outer";var sliderContainer=sliderWrapper+" .booking-entrypoint-calendar-inner";var sliderItems=".calendar-item";if($("body").find(sliderWrapper+" "+sliderItems).length>2){var storeIndex=parseInt($(".booking-filter-field--slider-index").val());if(storeIndex!==calendarSliderIndex){calendarSliderIndex=storeIndex}if(calendarSliderIndex!==calendarSliderIndexTemp&&calendarSliderIndexTemp!==null){calendarSliderIndex=calendarSliderIndexTemp}calendarSlider=tns({container:sliderContainer,items:2,slideBy:1,nav:false,mouseDrag:true,loop:false,gutter:30,disable:true,startIndex:calendarSliderIndex,responsive:{768:{disable:false}},controls:true,controlsContainer:sliderWrapper+" .slider-controls"});calendarSlider.events.on("indexChanged",function(){calendarSliderIndexTemp=calendarSlider.getInfo().index})}}function offerErrorHandling(state){if(state==="invalid"){$(".booking-filter-field--date-range").addClass("has-error");$(".booking-filter-field--date-range .booking-filter-field--text").text($(".booking-filter-field--date-range").data("placeholder"));$(".detail-booking-entrypoint .booking-btn").addClass("btn-disabled")}else{$(".booking-filter-field--date-range").removeClass("has-error");$(".booking-filter-field--date-range .booking-filter-field--text").text($(".booking-filter-field--daterange").val());$(".detail-booking-entrypoint .booking-btn").removeClass("btn-disabled")}}function requestHandlerOfferValidation(request){$.ajax({url:bookingOfferValidationServiceUrl,data:request,type:"POST",beforeSend:function(xhr){},success:function(data){offerErrorHandling(data["state"])}})}function requestHandlerBookingCalendar(request){$.ajax({url:bookingEntryCalendarServiceUrl,data:request,type:"POST",dataType:"html",beforeSend:function(xhr){console.log("before send");bookingEntryCalendarRenderTarget.addClass("is-loading")},success:function(data){bookingEntryCalendarRenderTarget.html(data);bookingEntryCalendarRenderTarget.removeClass("is-loading");initCalendarSlider();if(!$(".booking-filter-item--date-range").hasClass("open")){$(".booking-filter-item--date-range").addClass("open")}bookingCalendarInteraction()}})}function refreshBookingCalendar(transportType,airport,duration,offerID,mediaObjectID){renderBookingCalendar(transportType,airport,duration,offerID,mediaObjectID)}function bookingCalendarInteraction(){var travelDate=bookingEntryCalendarRenderTarget.find(".travel-date a");var durationSwitch=bookingEntryCalendarRenderTarget.find(".booking-entrypoint-calender-duration button");durationSwitch.on("click touch",function(e){e.preventDefault();if(!$(this).hasClass("active")){var getAirport=null;var getDur=$(this).data("duration");var getTransportType=$('.booking-filter-radio--transport-type input[type="radio"]:checked').val();var getOfferID=$(".booking-filter-field--offer-id").val();var getMediaObjectID=$(".booking-filter-field--mediaobject-id").val();if(getTransportType==="FLUG"){getAirport=bookingEntryAirportField.find('input[type="radio"]:checked').val()}durationSwitch.removeClass("active");$(this).addClass("active");refreshBookingCalendar(getTransportType,getAirport,getDur,getOfferID,getMediaObjectID)}e.stopPropagation()});var storeCurrentEnteredTravelDate=null;travelDate.on("mouseenter",function(e){if(!$(this).parent().hasClass("active")){var thisTravelDate=$(this);var thisOfferID=thisTravelDate.data("offer-id");storeCurrentEnteredTravelDate=$(this);var thisDaterangeItems=bookingEntryCalendarRenderTarget.find(".travel-date-"+thisOfferID);thisDaterangeItems.addClass("daterange-preview active-duration");thisDaterangeItems.last().addClass("active-duration-last");storeCurrentEnteredTravelDate.bind("mouseout",function(e){var thisDaterangePreviewItems=bookingEntryCalendarRenderTarget.find(".daterange-preview");if(!$(this).parent().hasClass("active")){thisDaterangePreviewItems.removeClass("active-duration");thisDaterangePreviewItems.removeClass("active-duration-last");thisDaterangePreviewItems.removeClass("daterange-preview")}else{thisDaterangePreviewItems.removeClass("daterange-preview")}})}});travelDate.on("mouseout",function(e){$(this).unbind("mouseout")});travelDate.on("click touch",function(e){e.preventDefault();var thisTravelDate=$(this);var thisTravelDatePrice=thisTravelDate.data("price-html");var thisOfferID=thisTravelDate.data("offer-id");var thisTravelDateRange=thisTravelDate.data("daterange");var thisTravelDateDur=parseInt(thisTravelDate.data("duration"));var thisTravelBookingUrl=thisTravelDate.attr("href");bookingEntryCalendarRenderTarget.find(".active-duration").removeClass("active-duration");bookingEntryCalendarRenderTarget.find(".active-duration-last").removeClass("active-duration-last");bookingEntryCalendarRenderTarget.find(".travel-date.active").removeClass("active");thisTravelDate.parent().addClass("active");var thisDaterangeItems=bookingEntryCalendarRenderTarget.find(".travel-date-"+thisOfferID);thisDaterangeItems.addClass("active-duration");thisDaterangeItems.last().addClass("active-duration-last");$(".booking-filter-field--offer-id").val(thisOfferID);$(".booking-filter-field--duration").val(thisTravelDateDur);$(".booking-filter-field--daterange").val(thisTravelDateRange);$(".booking-filter-item--date-range .booking-filter-field--text").text(thisTravelDateRange);$(".booking-filter-field--bookingurl").val(thisTravelBookingUrl);$(".detail-booking-entrypoint .booking-btn").attr("data-offer-id",thisOfferID);$(".detail-booking-entrypoint .booking-btn").attr("href",thisTravelBookingUrl);if(bookingEntryCalendarRenderTarget.find(".booking-entrypoint-calendar-inner").hasClass("tns-slider")){var calendarSliderInfo=calendarSlider.getInfo();var calendarSliderCurrentIndex=calendarSliderInfo.index;$(".booking-filter-field--slider-index").val(calendarSliderCurrentIndex)}if(thisTravelDatePrice!==""){$(".booking-action-row .price-box-discount").html(thisTravelDatePrice)}offerErrorHandling("valid");e.stopPropagation()});$(".booking-calendar-close").on("click touch",function(e){e.preventDefault();calendarSliderIndexTemp=null;$(this).parents(".booking-filter-item--date-range").removeClass("open");e.stopPropagation()})}function renderBookingCalendar(transportType,airport,duration,offerID,mediaObjectID){var calendarRequest={"pm-tr":transportType,airport:airport,"pm-du":duration,offer_id:offerID,media_object_id:mediaObjectID};requestHandlerBookingCalendar(calendarRequest)}}let offerList=".booking-offer-items";let offerItem=".booking-offer-item-label";let offerItemActiveClassName="is-active";if($(offerList).length>0&&$(offerItem).length>0){$(offerItem).on("click touch",function(e){e.preventDefault();var thisOffer=$(this);var thisOfferID=thisOffer.data("offer-id");var thisOfferPrice=thisOffer.data("price-html");var thisOfferDuration=thisOffer.data("duration");var thisOfferDateRange=thisOffer.data("daterange");var thisOfferBookingUrl=thisOffer.data("booking-url");$(offerList).find(offerItem).removeClass(offerItemActiveClassName);thisOffer.find("input").prop("checked",false);$(offerList).find("input").removeAttr("checked");thisOffer.addClass(offerItemActiveClassName);thisOffer.find("input").prop("checked",true);thisOffer.find("input").attr("checked","checked");$(".booking-filter-field--offer-id").val(thisOfferID);$(".booking-filter-field--duration").val(thisOfferDuration);$(".booking-filter-field--daterange").val(thisOfferDateRange);$(".booking-filter-field--bookingurl").val(thisOfferBookingUrl);if(thisOfferPrice!==""){$(".booking-action-row .price-box-discount").html(thisOfferPrice)}e.stopPropagation()})}});